<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blackjack Counter Pro</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-user-select: none;
      user-select: none;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: white;
      min-height: 100vh;
      padding: 16px;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    h1 {
      font-size: 28px;
      text-align: center;
      margin-bottom: 8px;
      background: linear-gradient(135deg, #4ade80, #60a5fa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .subtitle {
      text-align: center;
      font-size: 11px;
      opacity: 0.6;
      margin-bottom: 20px;
    }
    .box {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
    }
    .btn {
      width: 100%;
      padding: 16px;
      font-size: 16px;
      font-weight: 800;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      margin-bottom: 10px;
      text-transform: uppercase;
    }
    .btn-primary {
      background: linear-gradient(135deg, #4ade80, #22c55e);
      color: black;
    }
    .btn-secondary {
      background: linear-gradient(135deg, #60a5fa, #3b82f6);
      color: white;
    }
    .hidden { display: none; }
    .stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 16px;
    }
    .stat {
      background: rgba(255,255,255,0.1);
      padding: 10px;
      border-radius: 10px;
      text-align: center;
    }
    .stat-label {
      font-size: 9px;
      opacity: 0.7;
      text-transform: uppercase;
      margin-bottom: 4px;
    }
    .stat-value {
      font-size: 20px;
      font-weight: 900;
    }
    .positive { color: #4ade80; }
    .negative { color: #ef4444; }
    .neutral { color: #60a5fa; }
    .selector {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin: 12px 0;
    }
    .option {
      aspect-ratio: 1;
      background: rgba(0,0,0,0.3);
      border: 2px solid rgba(255,255,255,0.2);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      font-weight: 900;
      cursor: pointer;
      transition: all 0.2s;
    }
    .option.selected {
      background: linear-gradient(135deg, #4ade80, #22c55e);
      border-color: transparent;
      transform: scale(1.05);
    }
    .table-view {
      background: rgba(0,0,0,0.4);
      border-radius: 12px;
      padding: 12px;
      margin: 12px 0;
      text-align: center;
    }
    .table-title {
      font-size: 10px;
      opacity: 0.6;
      margin-bottom: 8px;
      text-transform: uppercase;
    }
    .positions {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 6px;
    }
    .chip {
      background: rgba(255,255,255,0.15);
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 700;
    }
    .chip.me {
      background: linear-gradient(135deg, #4ade80, #22c55e);
      color: black;
    }
    .chip.dealer {
      background: linear-gradient(135deg, #ef4444, #dc2626);
    }
    .controls {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-bottom: 16px;
    }
    .ctrl-btn {
      padding: 12px;
      font-size: 13px;
      font-weight: 800;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      text-transform: uppercase;
    }
    .cards {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      margin-bottom: 16px;
    }
    .card {
      aspect-ratio: 1;
      font-size: 20px;
      font-weight: 900;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      color: white;
      border: 3px solid rgba(255,255,255,0.2);
    }
    .card.low { background: linear-gradient(135deg, #4ade80, #22c55e); }
    .card.mid { background: linear-gradient(135deg, #60a5fa, #3b82f6); }
    .card.high { background: linear-gradient(135deg, #ef4444, #dc2626); }
    .ai {
      background: linear-gradient(135deg, rgba(74,222,128,0.2), rgba(34,197,94,0.15));
      border: 2px solid rgba(74,222,128,0.4);
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 16px;
      position: relative;
    }
    .ai::before {
      content: 'ü§ñ';
      position: absolute;
      top: 10px;
      right: 14px;
      font-size: 18px;
    }
    .ai-action {
      font-size: 26px;
      font-weight: 900;
      margin-bottom: 6px;
    }
    .ai-reason {
      font-size: 12px;
      opacity: 0.8;
      line-height: 1.4;
    }
    .hands {
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 16px;
    }
    .hand-row {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .hand-row.active {
      border: 2px solid #fbbf24;
      background: rgba(251,191,36,0.1);
    }
    .mini-card {
      background: rgba(255,255,255,0.15);
      padding: 3px 7px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 700;
      margin-right: 4px;
      display: inline-block;
    }
    .info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 16px;
    }
    .info-item {
      background: rgba(255,255,255,0.06);
      border-radius: 10px;
      padding: 10px;
      text-align: center;
    }
    .info-label {
      font-size: 9px;
      opacity: 0.6;
      text-transform: uppercase;
      margin-bottom: 4px;
    }
    .info-value {
      font-size: 14px;
      font-weight: 800;
    }
    .log {
      background: rgba(0,0,0,0.4);
      border-radius: 10px;
      padding: 12px;
      max-height: 200px;
      overflow-y: auto;
      font-size: 11px;
      line-height: 1.6;
      font-family: monospace;
    }
    .log-entry {
      padding: 4px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
  </style>
</head>
<body>
<div class="container">
  <h1>‚ô†Ô∏è BLACKJACK COUNTER PRO</h1>
  <div class="subtitle">Sistema Hi-Lo + Illustrious 18</div>

  <!-- WELCOME -->
  <div id="welcome">
    <div class="box">
      <h2 style="text-align:center; margin-bottom:16px;">üé∞ CONTADOR PROFESIONAL</h2>
      <div style="font-size:13px; line-height:1.6; margin-bottom:20px;">
        <strong>‚úì Sistema Hi-Lo</strong> con True Count truncado<br>
        <strong>‚úì Illustrious 18</strong> (desviaciones √≥ptimas)<br>
        <strong>‚úì Gesti√≥n de apuestas</strong> escalonada<br>
        <strong>‚úì Registro detallado</strong> de cada mano
      </div>
      <button class="btn btn-primary" onclick="goSetup()">‚ñ∂Ô∏è EMPEZAR</button>
    </div>
  </div>

  <!-- SETUP -->
  <div id="setup" class="hidden">
    <div class="stats">
      <div class="stat">
        <div class="stat-label">RC</div>
        <div class="stat-value neutral" id="rc1">0</div>
      </div>
      <div class="stat">
        <div class="stat-label">TC</div>
        <div class="stat-value neutral" id="tc1">0</div>
      </div>
      <div class="stat">
        <div class="stat-label">Apuesta</div>
        <div class="stat-value neutral" id="bet1">1x</div>
      </div>
      <div class="stat">
        <div class="stat-label">Manos</div>
        <div class="stat-value neutral" id="hands1">0</div>
      </div>
    </div>

    <div class="box">
      <h3 style="margin-bottom:12px; font-size:14px;">üë§ Jugadores ANTES de ti:</h3>
      <div class="selector" id="before"></div>

      <h3 style="margin:12px 0; font-size:14px;">üë§ Jugadores DESPU√âS de ti:</h3>
      <div class="selector" id="after"></div>

      <div class="table-view">
        <div class="table-title">Vista de la Mesa</div>
        <div class="positions" id="tableView"></div>
      </div>

      <button class="btn btn-primary" id="startBtn" onclick="start()" disabled>‚ñ∂Ô∏è COMENZAR</button>
    </div>
  </div>

  <!-- GAME -->
  <div id="game" class="hidden">
    <div class="stats">
      <div class="stat">
        <div class="stat-label">RC</div>
        <div class="stat-value neutral" id="rc2">0</div>
      </div>
      <div class="stat">
        <div class="stat-label">TC</div>
        <div class="stat-value neutral" id="tc2">0</div>
      </div>
      <div class="stat">
        <div class="stat-label">Apuesta</div>
        <div class="stat-value neutral" id="bet2">1x</div>
      </div>
      <div class="stat">
        <div class="stat-label">Manos</div>
        <div class="stat-value neutral" id="hands2">0</div>
      </div>
    </div>

    <div class="controls">
      <button class="ctrl-btn" style="background:#fbbf24; color:black;" onclick="undo()">‚Ü©Ô∏è Deshacer</button>
      <button class="ctrl-btn" style="background:#60a5fa; color:white;" onclick="next()">‚û°Ô∏è Siguiente</button>
      <button class="ctrl-btn" style="background:#ef4444; color:white;" onclick="end()">‚èπÔ∏è Terminar</button>
    </div>

    <div class="cards" id="cardGrid"></div>

    <div class="ai hidden" id="ai">
      <div class="ai-action" id="aiAction"></div>
      <div class="ai-reason" id="aiReason"></div>
    </div>

    <div class="hands" id="handsArea"></div>

    <div class="info-grid">
      <div class="info-item">
        <div class="info-label">Cartas</div>
        <div class="info-value" id="cardsPlayed">0/312</div>
      </div>
      <div class="info-item">
        <div class="info-label">Mazos Rest.</div>
        <div class="info-value" id="decksLeft">6.0</div>
      </div>
    </div>

    <details style="margin-bottom:16px;">
      <summary style="cursor:pointer; padding:10px; background:rgba(255,255,255,0.1); border-radius:8px; font-weight:700;">
        üìã Registro de Manos
      </summary>
      <div class="log" id="log"></div>
    </details>

    <button class="btn btn-secondary" onclick="resetAll()">üîÑ RESET TOTAL</button>
  </div>
</div>

<script>
// ==================== SISTEMA HI-LO ====================
const HI_LO = {'2':1,'3':1,'4':1,'5':1,'6':1,'7':0,'8':0,'9':0,'10':-1,'J':-1,'Q':-1,'K':-1,'A':-1};
const CARD_VALUES = {'2':2,'3':3,'4':4,'5':5,'6':6,'7':7,'8':8,'9':9,'10':10,'J':10,'Q':10,'K':10,'A':11};
const ALL_CARDS = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
const TOTAL_CARDS = 312; // 6 mazos

// ==================== ILLUSTRIOUS 18 ====================
const ILLUSTRIOUS_18 = {
  'insurance': 3,        // Seguro si TC >= +3
  '16v10': 0,           // 16 vs 10: Stand si TC >= 0
  '15v10': 4,           // 15 vs 10: Stand si TC >= +4
  '13v2': -1,           // 13 vs 2: Stand si TC >= -1
  '13v3': -2,           // 13 vs 3: Stand si TC >= -2
  '12v2': 3,            // 12 vs 2: Stand si TC >= +3
  '12v3': 2,            // 12 vs 3: Stand si TC >= +2
  '12v4': 0,            // 12 vs 4: Stand si TC >= 0
  '12v5': -2,           // 12 vs 5: Stand si TC >= -2
  '12v6': -1,           // 12 vs 6: Stand si TC >= -1
  '11vA': 1,            // 11 vs A: Double si TC >= +1
  '10v10': 4,           // 10 vs 10: Double si TC >= +4
  '10vA': 4,            // 10 vs A: Double si TC >= +4
  '9v2': 1,             // 9 vs 2: Double si TC >= +1
  '9v7': 3,             // 9 vs 7: Double si TC >= +3
  '20v5': 5,            // 10,10 vs 5: Split si TC >= +5
  '20v6': 4,            // 10,10 vs 6: Split si TC >= +4
  '16v9': 5             // 16 vs 9: Stand si TC >= +5
};

// ==================== ESTADO ====================
let state = 'welcome';
let playersBefore = 0;
let playersAfter = 0;
let allPlayers = [];
let currentIdx = 0;
let hands = {};
let history = [];
let runningCount = 0;
let cardsPlayed = 0;
let handsPlayed = 0;
let gameLog = [];

// ==================== NAVEGACI√ìN ====================
function goSetup() {
  document.getElementById('welcome').classList.add('hidden');
  document.getElementById('setup').classList.remove('hidden');
  state = 'setup';
  renderSetup();
  updateUI();
}

function renderSetup() {
  const before = document.getElementById('before');
  const after = document.getElementById('after');
  
  before.innerHTML = '';
  after.innerHTML = '';
  
  for(let i=0; i<=3; i++) {
    const opt1 = document.createElement('div');
    opt1.className = 'option';
    opt1.textContent = i;
    opt1.onclick = () => selectBefore(i);
    before.appendChild(opt1);
    
    const opt2 = document.createElement('div');
    opt2.className = 'option';
    opt2.textContent = i;
    opt2.onclick = () => selectAfter(i);
    after.appendChild(opt2);
  }
}

function selectBefore(n) {
  playersBefore = n;
  document.querySelectorAll('#before .option').forEach((el,i) => {
    el.classList.toggle('selected', i === n);
  });
  updateTable();
  document.getElementById('startBtn').disabled = false;
}

function selectAfter(n) {
  playersAfter = n;
  document.querySelectorAll('#after .option').forEach((el,i) => {
    el.classList.toggle('selected', i === n);
  });
  updateTable();
  document.getElementById('startBtn').disabled = false;
}

function updateTable() {
  const view = document.getElementById('tableView');
  let html = '';
  
  for(let i=1; i<=playersBefore; i++) {
    html += `<div class="chip">P${i}</div>`;
  }
  html += '<div class="chip me">üéÆ T√ö</div>';
  for(let i=1; i<=playersAfter; i++) {
    html += `<div class="chip">P${playersBefore+i}</div>`;
  }
  html += '<div class="chip dealer">üÉè DEALER</div>';
  
  view.innerHTML = html;
}

function start() {
  allPlayers = [];
  
  for(let i=1; i<=playersBefore; i++) {
    allPlayers.push({id:`p${i}`, label:`P${i}`, isMe:false});
  }
  allPlayers.push({id:'me', label:'T√ö', isMe:true});
  for(let i=1; i<=playersAfter; i++) {
    allPlayers.push({id:`p${playersBefore+i}`, label:`P${playersBefore+i}`, isMe:false});
  }
  allPlayers.push({id:'dealer', label:'Dealer', isMe:false});
  
  hands = {};
  allPlayers.forEach(p => hands[p.id] = []);
  history = [];
  currentIdx = 0;
  handsPlayed++;
  state = 'playing';
  
  logEntry(`[Mano #${handsPlayed}] Iniciada - ${allPlayers.length} jugadores`);
  
  document.getElementById('setup').classList.add('hidden');
  document.getElementById('game').classList.remove('hidden');
  
  renderCards();
  updateUI();
}

function renderCards() {
  const grid = document.getElementById('cardGrid');
  grid.innerHTML = '';
  
  ALL_CARDS.forEach(card => {
    const btn = document.createElement('button');
    btn.className = 'card';
    btn.textContent = card;
    btn.onclick = () => addCard(card);
    
    const val = HI_LO[card];
    if(val > 0) btn.classList.add('low');
    else if(val < 0) btn.classList.add('high');
    else btn.classList.add('mid');
    
    grid.appendChild(btn);
  });
}

function addCard(card) {
  if(state !== 'playing') return;
  
  const player = allPlayers[currentIdx];
  
  history.push({
    player: player.id,
    card: card,
    rcBefore: runningCount,
    playedBefore: cardsPlayed
  });
  
  runningCount += HI_LO[card];
  cardsPlayed++;
  hands[player.id].push(card);
  
  logEntry(`${player.label}: ${card} | RC=${runningCount > 0 ? '+'+runningCount : runningCount}`);
  
  if(navigator.vibrate) navigator.vibrate(5);
  
  updateUI();
}

function undo() {
  if(!history.length) return;
  
  const last = history.pop();
  runningCount = last.rcBefore;
  cardsPlayed = last.playedBefore;
  
  const hand = hands[last.player];
  if(hand.length) hand.pop();
  
  logEntry(`‚ü≤ Deshacer: ${last.card}`);
  
  if(navigator.vibrate) navigator.vibrate(10);
  updateUI();
}

function next() {
  if(state !== 'playing') return;
  currentIdx++;
  if(currentIdx >= allPlayers.length) currentIdx = 0;
  updateUI();
}

function end() {
  state = 'setup';
  
  const tc = getTrueCount();
  logEntry(`[Mano #${handsPlayed}] Finalizada - RC=${runningCount}, TC=${tc}`);
  
  allPlayers.forEach(p => hands[p.id] = []);
  history = [];
  currentIdx = 0;
  
  document.getElementById('game').classList.add('hidden');
  document.getElementById('setup').classList.remove('hidden');
  
  document.querySelectorAll('#before .option').forEach((el,i) => {
    el.classList.toggle('selected', i === playersBefore);
  });
  document.querySelectorAll('#after .option').forEach((el,i) => {
    el.classList.toggle('selected', i === playersAfter);
  });
  
  updateUI();
}

function resetAll() {
  if(!confirm('¬øResetear TODO? (RC, TC, historial)')) return;
  
  runningCount = 0;
  cardsPlayed = 0;
  handsPlayed = 0;
  playersBefore = 0;
  playersAfter = 0;
  allPlayers = [];
  history = [];
  gameLog = [];
  currentIdx = 0;
  hands = {};
  state = 'setup';
  
  document.getElementById('game').classList.add('hidden');
  document.getElementById('setup').classList.remove('hidden');
  
  renderSetup();
  updateTable();
  document.getElementById('startBtn').disabled = true;
  updateUI();
}

// ==================== C√ÅLCULOS ====================
function getTrueCount() {
  const decksRemaining = Math.max(0.5, (TOTAL_CARDS - cardsPlayed) / 52);
  // TRUNCAMIENTO (no redondeo al alza) seg√∫n Stanford Wong
  return Math.trunc(runningCount / decksRemaining);
}

function getBetUnits() {
  const tc = getTrueCount();
  // Sistema escalonado: 1 unidad por cada punto de TC positivo
  if(tc <= 0) return '1x';
  if(tc === 1) return '2x';
  if(tc === 2) return '3x';
  if(tc === 3) return '5x';
  if(tc === 4) return '7x';
  if(tc >= 5) return '10x';
  return '1x';
}

function handValue(hand) {
  if(!hand || !hand.length) return 0;
  let total = 0, aces = 0;
  hand.forEach(c => {
    if(c === 'A') { total += 11; aces++; }
    else total += CARD_VALUES[c];
  });
  while(total > 21 && aces > 0) { total -= 10; aces--; }
  return total;
}

function isSoft(hand) {
  if(!hand || !hand.length) return false;
  let total = 0, aces = 0;
  hand.forEach(c => {
    if(c === 'A') { total += 11; aces++; }
    else total += CARD_VALUES[c];
  });
  return aces > 0 && total <= 21;
}

function isPair(hand) {
  return hand.length === 2 && CARD_VALUES[hand[0]] === CARD_VALUES[hand[1]];
}

// ==================== ESTRATEGIA CON ILLUSTRIOUS 18 ====================
function getOptimalPlay(myHand, dealerCard) {
  const myTotal = handValue(myHand);
  const dealerValue = CARD_VALUES[dealerCard];
  const tc = getTrueCount();
  const soft = isSoft(myHand);
  const pair = isPair(myHand);
  
  // Blackjack
  if(myHand.length === 2 && myTotal === 21) {
    return {action:'STAND', emoji:'üéâ', reason:'¬°Blackjack! (21 natural)'};
  }
  
  // Bust
  if(myTotal > 21) {
    return {action:'BUST', emoji:'üí•', reason:'Te pasaste de 21'};
  }
  
  // SEGURO (Illustrious 18)
  if(dealerCard === 'A' && tc >= ILLUSTRIOUS_18.insurance) {
    return {action:'INSURANCE', emoji:'üõ°Ô∏è', reason:`Seguro TC‚â•+${ILLUSTRIOUS_18.insurance} (Ill-18)`};
  }
  
  // PAIRS
  if(pair) {
    const cardVal = CARD_VALUES[myHand[0]];
    
    // Siempre split Ases y 8s
    if(myHand[0] === 'A' || myHand[0] === '8') {
      return {action:'SPLIT', emoji:'‚úÇÔ∏è', reason:'Siempre divide Ases y 8s'};
    }
    
    // 10,10 vs 5 o 6 con TC alto (Illustrious 18)
    if(cardVal === 10) {
      if(dealerValue === 5 && tc >= ILLUSTRIOUS_18['20v5']) {
        return {action:'SPLIT', emoji:'‚úÇÔ∏è', reason:`10,10 vs 5 TC‚â•+${ILLUSTRIOUS_18['20v5']} (Ill-18)`};
      }
      if(dealerValue === 6 && tc >= ILLUSTRIOUS_18['20v6']) {
        return {action:'SPLIT', emoji:'‚úÇÔ∏è', reason:`10,10 vs 6 TC‚â•+${ILLUSTRIOUS_18['20v6']} (Ill-18)`};
      }
      return {action:'STAND', emoji:'‚úã', reason:'20 es excelente mano'};
    }
    
    // 9,9 vs 2-6
    if(cardVal === 9 && dealerValue >= 2 && dealerValue <= 6) {
      return {action:'SPLIT', emoji:'‚úÇÔ∏è', reason:'Divide 9,9 vs dealer d√©bil'};
    }
    
    // Nunca dividir 5s o 10s (excepto casos anteriores)
    if(cardVal === 5 || cardVal === 10) {
      return {action:'HIT', emoji:'üëÜ', reason:'Nunca dividas 5s o 10s'};
    }
  }
  
  // MANOS SOFT
  if(soft) {
    if(myTotal >= 19) {
      return {action:'STAND', emoji:'‚úã', reason:'Soft 19+ muy fuerte'};
    }
    
    if(myTotal === 18) {
      if(dealerValue >= 9) {
        return {action:'HIT', emoji:'üëÜ', reason:'Soft 18 vs 9/10/A: mejora'};
      }
      if(dealerValue >= 2 && dealerValue <= 6 && myHand.length === 2) {
        return {action:'DOUBLE', emoji:'üí∞', reason:'Soft 18 vs d√©bil: dobla'};
      }
      return {action:'STAND', emoji:'‚úã', reason:'Soft 18 aceptable'};
    }
    
    return {action:'HIT', emoji:'üëÜ', reason:'Soft 17- siempre pide'};
  }
  
  // MANOS DURAS - ILLUSTRIOUS 18
  
  // 16 vs 10 (Illustrious 18)
  if(myTotal === 16 && dealerValue === 10) {
    if(tc >= ILLUSTRIOUS_18['16v10']) {
      return {action:'STAND', emoji:'‚úã', reason:`16 vs 10 TC‚â•${ILLUSTRIOUS_18['16v10']} (Ill-18)`};
    }
    return {action:'HIT', emoji:'üëÜ', reason:'16 vs 10: pide (TC bajo)'};
  }
  
  // 16 vs 9 (Illustrious 18)
  if(myTotal === 16 && dealerValue === 9) {
    if(tc >= ILLUSTRIOUS_18['16v9']) {
      return {action:'STAND', emoji:'‚úã', reason:`16 vs 9 TC‚â•+${ILLUSTRIOUS_18['16v9']} (Ill-18)`};
    }
  }
  
  // 15 vs 10 (Illustrious 18)
  if(myTotal === 15 && dealerValue === 10) {
    if(tc >= ILLUSTRIOUS_18['15v10']) {
      return {action:'STAND', emoji:'‚úã', reason:`15 vs 10 TC‚â•+${ILLUSTRIOUS_18['15v10']} (Ill-18)`};
    }
    return {action:'HIT', emoji:'üëÜ', reason:'15 vs 10: pide (TC bajo)'};
  }
  
  // 13 vs 2 (Illustrious 18)
  if(myTotal === 13 && dealerValue === 2) {
    if(tc >= ILLUSTRIOUS_18['13v2']) {
      return {action:'STAND', emoji:'‚úã', reason:`13 vs 2 TC‚â•${ILLUSTRIOUS_18['13v2']} (Ill-18)`};
    }
    return {action:'HIT', emoji:'üëÜ', reason:'13 vs 2: pide (TC bajo)'};
  }
  
  // 13 vs 3 (Illustrious 18)
  if(myTotal === 13 && dealerValue === 3) {
    if(tc >= ILLUSTRIOUS_18['13v3']) {
      return {action:'STAND', emoji:'‚úã', reason:`13 vs 3 TC‚â•${ILLUSTRIOUS_18['13v3']} (Ill-18)`};
    }
    return {action:'HIT', emoji:'üëÜ', reason:'13 vs 3: pide (TC bajo)'};
  }
  
  // 12 vs 2-6 (Illustrious 18)
  if(myTotal === 12) {
    if(dealerValue === 2 && tc >= ILLUSTRIOUS_18['12v2']) {
      return {action:'STAND', emoji:'‚úã', reason:`12 vs 2 TC‚â•+${ILLUSTRIOUS_18['12v2']} (Ill-18)`};
    }
    if(dealerValue === 3 && tc >= ILLUSTRIOUS_18['12v3']) {
      return {action:'STAND', emoji:'‚úã', reason:`12 vs 3 TC‚â•+${ILLUSTRIOUS_18['12v3']} (Ill-18)`};
    }
    if(dealerValue === 4 && tc >= ILLUSTRIOUS_18['12v4']) {
      return {action:'STAND', emoji:'‚úã', reason:`12 vs 4 TC‚â•${ILLUSTRIOUS_18['12v4']} (Ill-18)`};
    }
    if(dealerValue === 5 && tc >= ILLUSTRIOUS_18['12v5']) {
      return {action:'STAND', emoji:'‚úã', reason:`12 vs 5 TC‚â•${ILLUSTRIOUS_18['12v5']} (Ill-18)`};
    }
    if(dealerValue === 6 && tc >= ILLUSTRIOUS_18['12v6']) {
      return {action:'STAND', emoji:'‚úã', reason:`12 vs 6 TC‚â•${ILLUSTRIOUS_18['12v6']} (Ill-18)`};
    }
    
    if(dealerValue >= 4 && dealerValue <= 6) {
      return {action:'STAND', emoji:'‚úã', reason:'12 vs 4-6: dealer d√©bil'};
    }
    return {action:'HIT', emoji:'üëÜ', reason:'12: pide'};
  }
  
  // 11 vs A (Illustrious 18)
  if(myTotal === 11 && dealerCard === 'A') {
    if(tc >= ILLUSTRIOUS_18['11vA'] && myHand.length === 2) {
      return {action:'DOUBLE', emoji:'üí∞', reason:`11 vs A TC‚â•+${ILLUSTRIOUS_18['11vA']} (Ill-18)`};
    }
  }
  
  // 11 (estrategia b√°sica)
  if(myTotal === 11 && myHand.length === 2) {
    return {action:'DOUBLE', emoji:'üí∞', reason:'11 perfecto para doblar'};
  }
  
  // 10 vs 10 y A (Illustrious 18)
  if(myTotal === 10 && myHand.length === 2) {
    if(dealerValue === 10 && tc >= ILLUSTRIOUS_18['10v10']) {
      return {action:'DOUBLE', emoji:'üí∞', reason:`10 vs 10 TC‚â•+${ILLUSTRIOUS_18['10v10']} (Ill-18)`};
    }
    if(dealerCard === 'A' && tc >= ILLUSTRIOUS_18['10vA']) {
      return {action:'DOUBLE', emoji:'üí∞', reason:`10 vs A TC‚â•+${ILLUSTRIOUS_18['10vA']} (Ill-18)`};
    }
    if(dealerValue >= 2 && dealerValue <= 9) {
      return {action:'DOUBLE', emoji:'üí∞', reason:'10 vs 2-9: dobla'};
    }
  }
  
  // 9 (Illustrious 18 + b√°sica)
  if(myTotal === 9 && myHand.length === 2) {
    if(dealerValue === 2 && tc >= ILLUSTRIOUS_18['9v2']) {
      return {action:'DOUBLE', emoji:'üí∞', reason:`9 vs 2 TC‚â•+${ILLUSTRIOUS_18['9v2']} (Ill-18)`};
    }
    if(dealerValue === 7 && tc >= ILLUSTRIOUS_18['9v7']) {
      return {action:'DOUBLE', emoji:'üí∞', reason:`9 vs 7 TC‚â•+${ILLUSTRIOUS_18['9v7']} (Ill-18)`};
    }
    if(dealerValue >= 3 && dealerValue <= 6) {
      return {action:'DOUBLE', emoji:'üí∞', reason:'9 vs 3-6: dobla'};
    }
  }
  
  // 17+
  if(myTotal >= 17) {
    return {action:'STAND', emoji:'‚úã', reason:'17+ evita riesgo'};
  }
  
  // 13-16 vs dealer
  if(myTotal >= 13 && myTotal <= 16) {
    if(dealerValue >= 2 && dealerValue <= 6) {
      return {action:'STAND', emoji:'‚úã', reason:'Dealer d√©bil: puede bustearse'};
    }
    return {action:'HIT', emoji:'üëÜ', reason:'Dealer fuerte: mejora'};
  }
  
  // Bajo
  return {action:'HIT', emoji:'üëÜ', reason:'Total bajo: pide'};
}

// ==================== UI ====================
function updateUI() {
  const decksRemaining = Math.max(0.5, (TOTAL_CARDS - cardsPlayed) / 52);
  const tc = getTrueCount();
  const bet = getBetUnits();
  
  // Stats
  const rcText = runningCount > 0 ? '+'+runningCount : runningCount;
  const tcText = tc > 0 ? '+'+tc : tc;
  
  document.getElementById('rc1').textContent = rcText;
  document.getElementById('tc1').textContent = tcText;
  document.getElementById('bet1').textContent = bet;
  document.getElementById('hands1').textContent = handsPlayed;
  
  document.getElementById('rc2').textContent = rcText;
  document.getElementById('tc2').textContent = tcText;
  document.getElementById('bet2').textContent = bet;
  document.getElementById('hands2').textContent = handsPlayed;
  
  // Colors
  ['rc1','rc2'].forEach(id => {
    const el = document.getElementById(id);
    el.className = 'stat-value';
    if(runningCount > 0) el.classList.add('positive');
    else if(runningCount < 0) el.classList.add('negative');
    else el.classList.add('neutral');
  });
  
  ['tc1','tc2'].forEach(id => {
    const el = document.getElementById(id);
    el.className = 'stat-value';
    if(tc > 0) el.classList.add('positive');
    else if(tc < 0) el.classList.add('negative');
    else el.classList.add('neutral');
  });
  
  // Info
  document.getElementById('cardsPlayed').textContent = `${cardsPlayed}/${TOTAL_CARDS}`;
  document.getElementById('decksLeft').textContent = decksRemaining.toFixed(1);
  
  // Hands
  if(state === 'playing') {
    updateHands();
    updateAI();
  }
  
  // Log
  updateLog();
}

function updateHands() {
  const area = document.getElementById('handsArea');
  let html = '';
  
  allPlayers.forEach((p,i) => {
    const hand = hands[p.id];
    if(!hand.length) return;
    
    const val = handValue(hand);
    const active = i === currentIdx ? 'active' : '';
    let valText = val;
    
    if(val > 21) valText = '<span style="color:#ef4444">BUST</span>';
    else if(val === 21 && hand.length === 2) valText = '<span style="color:#fbbf24">BJ!</span>';
    
    html += `
      <div class="hand-row ${active}">
        <div>
          <strong>${p.label}</strong>
          ${hand.map(c => `<span class="mini-card">${c}</span>`).join('')}
        </div>
        <div style="font-size:20px; font-weight:900;">${valText}</div>
      </div>
    `;
  });
  
  area.innerHTML = html;
}

function updateAI() {
  const myHand = hands.me;
  const dealerHand = hands.dealer;
  
  if(!myHand || !myHand.length || !dealerHand || !dealerHand.length) {
    document.getElementById('ai').classList.add('hidden');
    return;
  }
  
  const play = getOptimalPlay(myHand, dealerHand[0]);
  
  document.getElementById('ai').classList.remove('hidden');
  document.getElementById('aiAction').textContent = play.emoji + ' ' + play.action;
  document.getElementById('aiReason').textContent = play.reason;
}

function logEntry(text) {
  const timestamp = new Date().toLocaleTimeString('es-CO');
  gameLog.push(`[${timestamp}] ${text}`);
  if(gameLog.length > 50) gameLog.shift(); // Mantener √∫ltimas 50
}

function updateLog() {
  const logEl = document.getElementById('log');
  if(logEl) {
    logEl.innerHTML = gameLog.map(entry => 
      `<div class="log-entry">${entry}</div>`
    ).reverse().join('');
  }
}

// Init
updateTable();
</script>
</body>
</html>
